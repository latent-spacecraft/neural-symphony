[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:nginx]
command=nginx -g "daemon off;"
priority=100
autostart=true
autorestart=true
startsecs=5
startretries=3
stdout_logfile=/app/logs/nginx.log
stderr_logfile=/app/logs/nginx.error.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB

[program:ai-backend]
command=/app/start-ai-backend.sh
directory=/app
priority=200
autostart=true
autorestart=true
startsecs=30
startretries=3
user=root
environment=CUDA_VISIBLE_DEVICES=0,PYTHONPATH=/app,HF_HOME=/app/.cache/huggingface
stdout_logfile=/app/logs/ai-backend.log
stderr_logfile=/app/logs/ai-backend.error.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
killasgroup=true
stopasgroup=true

[program:node-backend]
command=/app/start-node-backend.sh
directory=/app
priority=300
autostart=true
autorestart=true
startsecs=10
startretries=3
user=root
environment=NODE_ENV=production,PORT=3001,WS_PORT=3002,AI_BACKEND_URL=http://127.0.0.1:8000
stdout_logfile=/app/logs/node-backend.log
stderr_logfile=/app/logs/node-backend.error.log
stdout_logfile_maxbytes=20MB
stderr_logfile_maxbytes=20MB
killasgroup=true
stopasgroup=true

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface